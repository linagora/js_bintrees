!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.RBTreeByIndex=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(){this._root=null,this._nil=new e("nil"),this._nil.red=!1,this._nil.weight=0,Object.defineProperty(this,"size",{get:function(){return this._root?this._root.weight:0}})}function e(a,b){this._dataBindName=b||"node",this._data=a,this.left=null,this.right=null,this.parent=null,this.red=!0,this.weight=1,Object.defineProperty(this,"next",{get:function(){return this.getNext()}}),Object.defineProperty(this,"prev",{get:function(){return this.getPrev()}}),Object.defineProperty(this,"data",{get:function(){return this._data},set:function(a){this._data=a,a[this._dataBindName]=this}})}var f=a("./treebase");d.prototype=new f,d.prototype.insert=function(a,b){var c=new e(b);return this.insert_node(a,c)?c:!1},d.prototype.insert_node=function(a,b){var c,d,e,f=this._root;if(!f)return this._root=b,this._root.red=!1,!0;for(;;){if(f.weight===a){c=f.max_tree(function(a){a.weight+=1}),c.set_child("right",b),b.parent=c;break}if(d=f.get_child("left"),e=f.get_child("right"),!d&&0===a){f.weight+=1,f.set_child("left",b),b.parent=f;break}if(d&&d.weight>=a)f.weight+=1,f=d;else{if(!e){f.weight+=1,f.set_child("right",b),b.parent=f;break}a-=(d?d.weight:0)+1,f.weight+=1,f=e}}return this.insert_correction(b),!0},d.prototype.insert_between=function(a,b,c){var d=new e(c);return a&&!a.right?(a.right=d,d.parent=a,this.insert_correction(d)):b&&!b.left?(b.left=d,d.parent=b,this.insert_correction(d)):this.insert_node(0,d),d.traverse_up(function(a,b){b.weight=(b.left?b.left.weight:0)+(b.right?b.right.weight:0)+1}),d},d.prototype.rotate=function(a,b){var c;c=b.get_child(a,!0),b.set_child(a,c.get_child(a),!0),c.get_child(a)&&(c.get_child(a).parent=b),c.parent=b.parent,b.parent?b===b.parent.get_child(a)?b.parent.set_child(a,c):b.parent.set_child(a,c,!0):this._root=c,c.set_child(a,b),b.parent=c,b.weight=(b.left?b.left.weight:0)+(b.right?b.right.weight:0)+1,c.weight=(c.left?c.left.weight:0)+(c.right?c.right.weight:0)+1},d.prototype.insert_correction=function(a){function b(b){var d;if(d=a.parent.parent.get_child(b,!0),d&&d.red)a.parent.red=!1,d.red=!1,a.parent.parent.red=!0,a=a.parent.parent;else{a===a.parent.get_child(b,!0)&&(a=a.parent,c.rotate(b,a)),a.parent.red=!1,a.parent.parent.red=!0;var e="left"===b?"right":"left";c.rotate(e,a.parent.parent)}}for(var c=this;a.parent&&a.parent.red;)a.parent===a.parent.parent.get_child("left")?b("left"):a.parent===a.parent.parent.get_child("right")&&b("right");this._root.red=!1},d.prototype.find=function(){var a=this.findNode.apply(this,arguments);return a?a.data:null},d.prototype.findNode=function(a,b){var c,d;if(a>=this.size||0>a)return null;var e=this._root;if(!e)return null;for(;a>0||0===a&&e.left;)if(c=e.left,d=e.right,c&&c.weight>a)b&&b(e),e=c;else{if(!c&&0===a||c&&c.weight===a)break;if(!d)throw new Error("this should not happen");b&&b(e),e=d,a-=(c?c.weight:0)+1}return e},d.prototype.remove=function(a){var b;return b=this.findNode(a,function(a){a.weight--}),this.remove_helper(b)},d.prototype.remove_helper=function(a){var b,c,d;return b=a.left&&a.right?a.getNext(function(a){a.weight-=1}):a,b.left?(c=b.left,d=b.parent):(c=b.right,d=b.parent),c&&(c.parent=b.parent),b.parent?b===b.parent.left?b.parent.left=c:b.parent.right=c:this._root=c,b!==a&&(a.data=b.data,a.weight=(a.left?a.left.weight:0)+(a.right?a.right.weight:0)+1),b.red||this.remove_correction(c,d),b},d.prototype.remove_node=function(a){return a.traverse_up(function(a,b){b.weight--}),this.remove_helper(a)},d.prototype.remove_correction=function(a,b){for(var c,d,e=this,f=function(d){var f=b.get_child(d,!0);f&&f.red&&(f.red=!1,b.red=!0,e.rotate(d,b),f=b.get_child(d,!0)),f.left&&f.left.red||f.right&&f.right.red?(f.get_child(d,!0)&&f.get_child(d,!0).red||(f.get_child(d)&&(f.get_child(d).red=!1),f.red=!0,c="left"===d?"right":"left",e.rotate(c,f),f=b.get_child(d,!0)),f.red=b?b.red:!1,b.red=!1,f.get_child(d,!0)&&(f.get_child(d,!0).red=!1),e.rotate(d,b),a=e._root,b=a.parent):(f.red=!0,a=b,b=a.parent)};!(a===this._root||a&&a.red);)a===b.get_child("left")?d=f("left"):a===b.get_child("right")&&(d=f("right"));a&&(a.red=!1)},e.prototype.get_child=function(a,b){return b&&(a="left"===a?"right":"left"),"left"===a?this.left:this.right},e.prototype.set_child=function(a,b,c){c&&(a="left"===a?"right":"left"),"left"===a?this.left=b:this.right=b},e.prototype.max_tree=function(a){var b=this;for(a&&a(b);b.right;)b=b.right,a&&a(b);return b},e.prototype.min_tree=function(a){var b=this;for(a&&a(b);b.left;)b=b.left,a&&a(b);return b},e.prototype.getNext=function(a){var b,c;if(this.get_child("right"))return this.get_child("right").min_tree(a);for(a&&a(this),b=this,c=this.parent;c&&b===c.get_child("right");)b=c,c=b.parent,a&&a(c);return c},e.prototype.getPrev=function(a){var b,c;if(this.get_child("left"))return this.get_child("left").max_tree(a);for(a&&a(this),b=this,c=this.parent;c&&b===c.get_child("left");)b=c,c=b.parent,a&&a(c);return c},e.prototype.traverse_up=function(a){for(var b=this.parent,c=this;b;)a(c,b),c=b,b=b.parent},e.prototype.depth=function(){var a=0;return this.traverse_up(function(){a++}),a},e.prototype.position=function(){var a=this.left?this.left.weight:0,b=function(b,c){c.right===b&&(c.left&&(a+=c.left.weight),a+=1)};return this.traverse_up(b),a},b.exports=d},{"./treebase":2}],2:[function(a,b,c){"use strict";function d(){}var e;d.prototype.clear=function(){this._root=null,this.size=0},d.prototype.find=function(a){for(var b=this._root;null!==b;){var c=this._comparator(a,b.data);if(0===c)return b.data;b=b.get_child(c>0)}return null},d.prototype.findIter=function(a){for(var b=this._root,c=this.iterator();null!==b;){var d=this._comparator(a,b.data);if(0===d)return c._cursor=b,c;c._ancestors.push(b),b=b.get_child(d>0)}return null},d.prototype.lowerBound=function(a){for(var b=this._root,c=this.iterator(),d=this._comparator;null!==b;){var e=d(a,b.data);if(0===e)return c._cursor=b,c;c._ancestors.push(b),b=b.get_child(e>0)}for(var f=c._ancestors.length-1;f>=0;--f)if(b=c._ancestors[f],d(a,b.data)<0)return c._cursor=b,c._ancestors.length=f,c;return c._ancestors.length=0,c},d.prototype.upperBound=function(a){for(var b=this.lowerBound(a),c=this._comparator;0===c(b.data(),a);)b.next();return b},d.prototype.min=function(){var a=this._root;if(null===a)return null;for(;null!==a.left;)a=a.left;return a.data},d.prototype.max=function(){var a=this._root;if(null===a)return null;for(;null!==a.right;)a=a.right;return a.data},d.prototype.iterator=function(){return new e(this)},d.prototype.eachNode=function(a){for(var b,c=this.iterator(),d=0;null!==(b=c.next());)a(b,d),d++},d.prototype.each=function(a){this.eachNode(function(b,c){a(b.data,c)})},d.prototype.mapNode=function(a){for(var b,c=this.iterator(),d=[],e=0;null!==(b=c.next());)d.push(a(b,e)),e++;return d},d.prototype.map=function(a){return this.mapNode(function(b,c){return a(b.data,c)})},e=function(a){this._tree=a,this._ancestors=[],this._cursor=null},e.prototype.data=function(){return null!==this._cursor?this._cursor.data:null},e.prototype.next=function(){if(null===this._cursor){var a=this._tree._root;null!==a&&this._minNode(a)}else if(null===this._cursor.right){var b;do{if(b=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.right===b)}else this._ancestors.push(this._cursor),this._minNode(this._cursor.right);return null!==this._cursor?this._cursor:null},e.prototype.prev=function(){if(null===this._cursor){var a=this._tree._root;null!==a&&this._maxNode(a)}else if(null===this._cursor.left){var b;do{if(b=this._cursor,!this._ancestors.length){this._cursor=null;break}this._cursor=this._ancestors.pop()}while(this._cursor.left===b)}else this._ancestors.push(this._cursor),this._maxNode(this._cursor.left);return null!==this._cursor?this._cursor:null},e.prototype._minNode=function(a){for(;null!==a.left;)this._ancestors.push(a),a=a.left;this._cursor=a},e.prototype._maxNode=function(a){for(;null!==a.right;)this._ancestors.push(a),a=a.right;this._cursor=a},b.exports=d},{}]},{},[1])(1)});